# Поиск аномалий - система алертов

## Описание проекта 

**Цель:** Изучить поведение метрик и подобрать наиболее подходящий метод для детектирования аномалий.  
**Задачи:** Каждые 15 минут DAG Airflow проверять ключевые метрики на наличие аномалий - такие как:  
- активные пользователи в ленте/мессенджере
- просмотры
- лайки
- CTR
- кол-во отправленных сообщений  

В случае обнаружения аномального значения, в чат должен отправиться алерт — сообщение со следующей информацией: метрика, ее значение, величина отклонения.

## Методология

### Правило трех сигм

Метод применим для поиска аномалий в выборках, имеющих нормальное распределение или близкое к нему.
В данном случае CTR распределен нормально, поэтому для поиска аномалий для CTR используется данный метод.
Идея алгоритма проста, с помощью правила трех сигм строиться доверительный интервал, то что выходит за эти рамки
считаем аномалией. 

Выбросы по правилу трех сигм определяются следующим образом:
$$x_i < \mu - 3\sigma \quad \text{или} \quad x_i > \mu + 3\sigma$$
где $\mu$ — среднее значение, а $\sigma$ — стандартное отклонение.

### Межквартильный размах

Идея аналогичная предыдущему методу, но не требующая нормальности распределения. Для всех остальных метрик используется данный метод.

Выбросы определяются следующим образом:
$$x_i < Q_{25} - a \cdot IQR \quad \text{или} \quad x_i > Q_{75} + a \cdot IQR$$
где $IQR$ — межквартильный размах, а $a$ — коэффициент.

## Пример сообщения алерта в телеграм
![alert-telegram](https://github.com/v-makarov-code/anomaly-alert-DAG/blob/main/anomaly_report.png)  
*Рис.1. Пример сообщения в телеграм при обнаруженной аномалии в метрике*

### Вид дашборда на который указывает ссылка
![dashboard](https://github.com/v-makarov-code/anomaly-alert-DAG/blob/main/%D0%BB%D0%B5%D0%BD%D1%82%D0%B0-%D0%B8-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F-2025-08-05T11-51-49.456Z.jpg)  
*Рис.2. Дашборд Superset для отслеживания ключевых метрик в realtime*
## Технологии 

- Python 3.12(numpy, pandas, telegram, airflow)
- Apache Airflow 2.2.4
- ClickHouse
- Superset 2.1.3




